<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgroTrack SMS Simulator</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState } = React;
        const { MessageSquare, Send, Phone, CheckCircle } = {
            MessageSquare: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>,
            Send: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m22 2-7 20-4-9-9-4Z"></path><path d="M22 2 11 13"></path></svg>,
            Phone: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>,
            CheckCircle: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
        };

        function SMSSimulator() {
          const [phoneNumber, setPhoneNumber] = useState('+254712345678');
          const [message, setMessage] = useState('');
          const [conversation, setConversation] = useState([]);
          const [isProcessing, setIsProcessing] = useState(false);

          const cropPrices = {
            'maize': 45,
            'beans': 120,
            'tomatoes': 60,
            'potatoes': 35,
            'coffee': 200
          };

          const parseMessage = (msg) => {
            const parts = msg.toLowerCase().trim().split(' ');
            const crop = parts[0];
            const quantity = parts[1];
            const location = parts[2] || 'Unknown';
            
            return { crop, quantity, location };
          };

          const generateOTP = () => {
            return Math.floor(100000 + Math.random() * 900000).toString();
          };

          const handleSendSMS = () => {
            if (!message.trim()) return;

            const farmerMsg = {
              type: 'sent',
              text: message,
              time: new Date().toLocaleTimeString()
            };
            
            setConversation([...conversation, farmerMsg]);
            setIsProcessing(true);

            setTimeout(() => {
              const parsed = parseMessage(message);
              const crop = parsed.crop;
              const qtyText = parsed.quantity;
              const location = parsed.location;
              
              const qtyNum = parseFloat(qtyText?.replace(/[^\d.]/g, '')) || 0;
              const pricePerKg = cropPrices[crop] || 50;
              const totalPrice = (qtyNum * pricePerKg).toFixed(2);
              const otp = generateOTP();
              const tradeId = Math.random().toString(36).substr(2, 8);

              const response = {
                type: 'received',
                text: `✅ AGROTRACK OFFER\n\nTrade ID: ${tradeId}\nCrop: ${crop.toUpperCase()}\nQty: ${qtyText}\nLocation: ${location}\n\nOFFER: KES ${totalPrice}\nPrice/kg: KES ${pricePerKg}\nBuyer: ${location} Farmers Co-op\n\nPickup: Tomorrow 10:00 AM\nOTP: ${otp}\n\n⏳ Waiting for buyer acceptance...\n\nReply ACCEPT to confirm\nReply CANCEL to reject`,
                time: new Date().toLocaleTimeString(),
                tradeData: {
                  tradeId,
                  crop,
                  quantity: qtyText,
                  location,
                  pricePerKg,
                  totalPrice,
                  otp
                }
              };

              setConversation(prev => [...prev, response]);
              setIsProcessing(false);
              setMessage('');
            }, 2000);
          };

          const quickTemplates = [
            'Maize 200kg Kisumu',
            'Beans 150kg Eldoret',
            'Tomatoes 80kg Nairobi',
            'Potatoes 300kg Nakuru'
          ];

          return (
            <div className="min-h-screen bg-gradient-to-br from-emerald-50 to-teal-100 flex items-center justify-center p-4">
              <div className="max-w-md w-full">
                <div className="bg-gray-900 rounded-3xl shadow-2xl p-3">
                  <div className="bg-black rounded-2xl overflow-hidden">
                    <div className="h-6 bg-black flex items-center justify-center">
                      <div className="w-32 h-4 bg-gray-900 rounded-full"></div>
                    </div>
                    
                    <div className="bg-white h-[600px] flex flex-col">
                      <div className="bg-gradient-to-r from-green-600 to-emerald-600 text-white p-4 flex items-center gap-3">
                        <div className="bg-white bg-opacity-20 rounded-full p-2">
                          <MessageSquare className="h-6 w-6" />
                        </div>
                        <div className="flex-1">
                          <h2 className="font-bold">AgroTrack SMS</h2>
                          <p className="text-xs opacity-90">*384*96#</p>
                        </div>
                        <Phone className="h-5 w-5" />
                      </div>

                      <div className="flex-1 overflow-y-auto p-4 space-y-3 bg-gray-50">
                        {conversation.length === 0 && (
                          <div className="text-center py-8">
                            <MessageSquare className="h-12 w-12 text-gray-300 mx-auto mb-3" />
                            <p className="text-gray-500 text-sm">Send SMS to start trading</p>
                            <p className="text-gray-400 text-xs mt-1">Format: Crop Quantity Location</p>
                          </div>
                        )}
                        
                        {conversation.map((msg, idx) => (
                          <div
                            key={idx}
                            className={`flex ${msg.type === 'sent' ? 'justify-end' : 'justify-start'}`}
                          >
                            <div
                              className={`max-w-[80%] rounded-2xl px-4 py-2 ${
                                msg.type === 'sent'
                                  ? 'bg-green-600 text-white rounded-br-sm'
                                  : 'bg-white text-gray-800 rounded-bl-sm shadow'
                              }`}
                            >
                              <p className="text-sm whitespace-pre-wrap">{msg.text}</p>
                              <p className={`text-xs mt-1 ${
                                msg.type === 'sent' ? 'text-green-100' : 'text-gray-400'
                              }`}>
                                {msg.time}
                              </p>
                            </div>
                          </div>
                        ))}

                        {isProcessing && (
                          <div className="flex justify-start">
                            <div className="bg-white rounded-2xl rounded-bl-sm shadow px-4 py-3">
                              <div className="flex space-x-2">
                                <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div>
                                <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{animationDelay: '0.2s'}}></div>
                                <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{animationDelay: '0.4s'}}></div>
                              </div>
                            </div>
                          </div>
                        )}
                      </div>

                      <div className="px-4 py-2 bg-white border-t">
                        <p className="text-xs text-gray-600 mb-2">Quick templates:</p>
                        <div className="flex gap-2 overflow-x-auto pb-2">
                          {quickTemplates.map((template, idx) => (
                            <button
                              key={idx}
                              onClick={() => setMessage(template)}
                              className="bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs whitespace-nowrap hover:bg-green-200 transition-colors"
                            >
                              {template}
                            </button>
                          ))}
                        </div>
                      </div>

                      <div className="p-4 bg-white border-t">
                        <div className="flex items-center gap-2">
                          <input
                            type="text"
                            value={message}
                            onChange={(e) => setMessage(e.target.value)}
                            onKeyPress={(e) => e.key === 'Enter' && handleSendSMS()}
                            placeholder="Type crop, quantity, location..."
                            className="flex-1 px-4 py-2 border-2 border-gray-300 rounded-full focus:border-green-500 focus:outline-none text-sm"
                          />
                          <button
                            onClick={handleSendSMS}
                            disabled={!message.trim() || isProcessing}
                            className="bg-green-600 hover:bg-green-700 disabled:bg-gray-300 text-white p-2 rounded-full transition-colors"
                          >
                            <Send className="h-5 w-5" />
                          </button>
                        </div>
                        <p className="text-xs text-gray-500 mt-2 text-center">
                          From: {phoneNumber}
                        </p>
                      </div>
                    </div>
                  </div>
                </div>

                <div className="mt-6 bg-white rounded-lg shadow-lg p-4">
                  <h3 className="font-bold text-gray-800 mb-2 flex items-center gap-2">
                    <CheckCircle className="h-5 w-5 text-green-600" />
                    How It Works
                  </h3>
                  <div className="space-y-2 text-sm text-gray-600">
                    <p><strong>1.</strong> Send SMS with: Crop, Quantity, Location</p>
                    <p><strong>2.</strong> AI matches you with best buyer</p>
                    <p><strong>3.</strong> Receive offer with OTP</p>
                    <p><strong>4.</strong> Buyer creates escrow on Hedera</p>
                    <p><strong>5.</strong> Deliver goods, verify with OTP</p>
                    <p><strong>6.</strong> Get paid instantly via M-Pesa</p>
                  </div>
                  
                  <div className="mt-4 pt-4 border-t">
                    <div className="flex items-center justify-between text-xs">
                      <span className="text-gray-600">Powered by</span>
                      <div className="flex gap-3">
                        <span className="font-semibold text-purple-600">Hedera</span>
                        <span className="text-gray-400">|</span>
                        <span className="font-semibold text-green-600">M-Pesa</span>
                        <span className="text-gray-400">|</span>
                        <span className="font-semibold text-blue-600">AI</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          );
        }

        ReactDOM.render(<SMSSimulator />, document.getElementById('root'));
    </script>
</body>
</html>
